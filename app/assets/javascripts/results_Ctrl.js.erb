/*global angular */

(function() {
  "use strict";

  angular.module("app").controller('resultsCtrl', function($scope, $http) {


    $scope.setUp = function() { 



      var currentTime = new Date();
      var day = currentTime.getDate();
      var month = currentTime.getMonth() + 1;
      var year = currentTime.getFullYear();

  

      var todayDate = year + "-" + month + "-" + day;
      var todayDateString = todayDate.toString();
      $scope.date = todayDateString; 

      console.log("price: " + $scope.slicePrice);

      var first = { 
        method: 'POST',
        url: "https://www.googleapis.com/qpxExpress/v1/trips/search?key=" + "<%=ENV['GOOGLE_API_KEY'] %>",

        
        data: {
          "request": {
            "passengers": {
              "adultCount": "1"
            },
            "slice": [
              {
                "origin": $scope.originPlace,
                "destination": "LAS",
                "date": todayDateString
              }
            ],
            "solutions": "20",

          }
        }
      };

      $http(first).then(function(response) {
        $scope.results = response.data;
        $scope.tripOptions = $scope.results.trips.tripOption;
        $.each($scope.tripOptions, function() {
          this.saleTotal = parseFloat(this.saleTotal.slice(3, this.saleTotal.length));
        });
      

      });


      


      $scope.myOrder = function(attribute) {
        if (attribute != $scope.defOrder) {
          $scope.direction = false;
        } else {
          $scope.direction = !$scope.direction;
        }
        $scope.defOrder = attribute;
      };


     

    


    };


  });

}());
